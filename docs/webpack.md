---
sidebar_position: 7
---


# Webpack 5
- `target: [ 'web', 'es5' ]` to transpile to ES5 (游냥 for some reason ts-loader does not take this field from tsconfig.json)
- circular dependencies
  - webpack survives circular dependencies up to some unspecified point
  - 游냥 when circulars are too complex, webpack throws no error, you will find out about it only in runtime! This is one of the worst things that can ever happen, I still cannot understand how this is possible.
    - to prevent this use `circular-dependency-plugin`, with my visualizer `git+https://github.com/fingerartur/circular-dependency-plugin-visualizer.git`
- merge two configs via `webpack-merge` (游냥 cannot believe it is not built-in)
- pass pseudo `process.env` to FE code via built-in `new webpack.DefinePlugin({`

TODO 4 vs 5

TODO
  - can import images as dependency (json, png, any FILE) `import img from './imgs/img1.png'
  - WTF mode:production bundles peerDependencies (and normal dependencies too i think:) ) !!!! ... we have to use externals https://webpack.js.org/configuration/externals
  - source maps in production yes or no??? definitely not inline sourcemaps tho!! (sourceMapURL is data url inlined in the file ... not even recommended by webpack :))
  - TODO source maps: https://blog.scottlogic.com/2017/11/01/webpack-source-map-options-quick-guide.html






# Source maps
- allow me to see original un-minified, un-bundled source files and file structure based for a specific line of compiled bundle
- debugger loads them based on last line of chunk file ```//# sourceMappingURL=main.78fbc578.chunk.js.map```
- they can be large and can take some time to initialize
- they translate col,row -> filename, col, row
- they also contain the original sources concatenated in an array
- structure
```
{
    version: 3, // current standard
    file: "chunk.js",
    sources: [ "file1.js", "file2.js" ],
    sourcesContent: [ "content1", "content2" ],
    mappings: ";;;asdfadf...",
}
```
- they can be generated by webpack
```
    devtool: 'source-map' // generates source maps like chunk.js.map in ./dist
    devtool: false

    new webpack.SourceMapDevToolPlugin({
        filename: '[file].map', // change output file name
        publicPath: 'https://example.com/dev/' // change output file URI (default is relative .
        - same as source)
    });
```
- who needs sourcemaps:
  - sentry (can auto-load them)
  - me when somebody is showing me a bug in the console (browser auto-loads them)
- What about lib source-maps?
  - 游봈 I think they should not work because the lib is not in a separate chunk and probably it's sourceMappingUrl is relative, but that cannot work, because nobody is hosting that source map. ...Maybe this https://www.npmjs.com/package/source-map-loader will work?
  - It is also possible to use in-line source maps `devtool: 'eval-cheap-module-source-map'` however browser than doubles every file for some reason 游냥
- security:
  - host your source maps on a private server inside a VPN, then only you will be able to load them (rewrite sourceMappingUrl). Nice but this way sentry cannot access them
  - if Sentry cannot access your source-maps, you can upload them manually or [automatically w webpack](https://docs.sentry.io/platforms/javascript/sourcemaps/)
    - since code evolves, errors are mapped to correct source-map versions by `.release` attribute (each build of your app has to have a new version/release number)
