
## How to import a library (CJS, UMD)
I have a big problem finding documentation on this. There are bits and pieces here and there but never the full picture and never all the information.

[Doc1](https://github.com/google/closure-compiler/wiki/JS-Modules)
[Doc2](https://github.com/google/closure-compiler/wiki/Managing-Dependencies)
Closest to a good explanation is [here](https://stackoverflow.com/questions/41832896/google-closure-compiler-process-node-modules).

By trial and error I managed to get it work with `lodash` like this:

1. `--process_common_js_modules`, because most libs CJS or UMD which is compatible with CJS
2. `--module_resolution=WEBPACK`, otherwise it is not possible to import from `node_modules` (default resolution is BROWSER and that takes only relative paths)
3. `--js=node_modules/lodash/package.json --js=node_modules/lodash/**.js` for the compiler [to find lodash](https://stackoverflow.com/questions/41832896/google-closure-compiler-process-node-modules). This is not well documented at all.
4. `--hide_warnings_for=node_modules/lodash` to make sure closure does not type-check the library itself. Again [not documented](https://stackoverflow.com/questions/47668995/google-closure-suppress-warning-messages-for-a-particular-file).

TODO something does not seem right because vscode/TS types are off. Actually there seems to be an error in the types, not in the import mechanism.
TODO [about externs](https://stackoverflow.com/questions/21122259/creating-closure-compiler-extern)
  - https://blogs.missouristate.edu/web/2013/09/12/how-to-write-closure-compiler-extern-files-part-1-the-basics/ I failed to define externs for lodash, this article says literally nothing!

## Some libraries do not get imported!
- [merge](https://www.npmjs.com/package/merge) - Fails. seems to be CJS. Direct import works
- [xtend](https://www.npmjs.com/package/xtend) - Fails. seems to be CJS. Direct import works
- [array-flatten](https://www.npmjs.com/package/array-flatten) - Fails. seems to be CJS
- [react](https://www.npmjs.com/package/react) - here the problem is process.env in index file
  ```js
  'use strict';

  if (process.env.NODE_ENV === 'production') {
    module.exports = require('./cjs/react.production.min.js');
  } else {
    module.exports = require('./cjs/react.development.js');
  }

  ```
  But a direct import works. Again it seems CJS
  ```js
  const react = require('react/cjs/react.production.min.js')
  console.log('react: ', react);
  ```
- [redux](https://www.npmjs.com/package/redux). Fails. seems to be UMD.
  But a direct import works.
  ```js
  const redux = require('redux/dist/redux.js')
  console.log('redux: ', redux);
  ```
- my library build with webpack as commonjs-static. Finally a direct import works
  ```js
  const libtypes = require('libtypes/dist/index.js')
  console.log('libtypes: ', libtypes);
  ```

TODO https://github.com/google/closure-compiler/issues/3714

## How to import Node.js stdlib

1. Importing stdlib in node.js is [not supported](https://github.com/google/closure-compiler/issues/3719), you have to do a big workaround (fake node_modules basically)

